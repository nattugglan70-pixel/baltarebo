<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Väderdashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
  }

  .section {
    margin: 10px 0;
    padding: 25px;
    background: #111;
    border-radius: 12px;
    width: 380px;
    box-shadow: 0 2px 10px rgba(255,255,255,0.2);
    text-align: center;
  }

  .value {
    font-size: 32px;
    font-weight: bold;
    margin: 8px 0;
  }

  .subtext {
    font-size: 16px;
    color: #ccc;
    margin: 5px 0;
  }

  .minmax {
    font-size: 20px;
    margin: 6px 0;
    line-height: 1.5;
  }

  .yesterday-temp {
    color: gold;
    font-size: 24px;
    margin-top: 4px;
  }

  .icon {
    font-size: 24px;
    margin-left: 8px;
  }
</style>
</head>
<body>

<div class="section">
  <div id="date-week"></div>
  <div class="subtext" id="weather-updated">Senast uppdaterad: --:--</div>
</div>

<div class="section">
  <div class="value" id="currentTemp">-- °C</div>
  <div class="yesterday-temp" id="temp-yesterday">-- °C</div>
</div>

<div class="section">
  <div class="subtext" id="wind">Vind: -- m/s</div>
  <div class="subtext" id="humidity">Luftfuktighet: -- %</div>
  <div class="subtext" id="pressure">Tryck: -- hPa</div>
  <div class="subtext" id="precipitation">Nederbörd: -- mm | Risk 24h: -- % <span class="icon" id="precip-icon"></span></div>
</div>

<div class="section">
  <div class="minmax" id="temp-minmax">
    Min: -- °C kl --:--<br>
    Max: -- °C kl --:--
  </div>
</div>

<div class="section">
  <div class="minmax" id="temp-yesterday-minmax">
    Min: --<br>
    Max: --
  </div>
</div>

<script>
const lat = 57.114025;
const lon = 14.168177;
const apiKey = "edba13104e1d46b293b234713262002"; // <-- KListra in din WeatherAPI-nyckel här

// Datum och veckonummer
function updateDateWeek() {
  const now = new Date();
  const week = Math.ceil((((now - new Date(now.getFullYear(),0,1))/86400000) + new Date(now.getFullYear(),0,1).getDay()+1)/7);
  document.getElementById('date-week').innerText = now.toLocaleDateString('sv-SE', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }) + ' | Vecka ' + week;
}

// Hämta väder från WeatherAPI
async function updateWeather() {
    try {
        const res = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${lat},${lon}&days=2&lang=sv`);
        const data = await res.json();
        const now = new Date();

        // Aktuell temperatur
        const currentTemp = data.current.temp_c;
        document.getElementById('currentTemp').innerText = currentTemp.toFixed(1) + " °C";

        // Gårdagens temperatur samma tid (gul text)
        const yesterdayHour = now.getHours();
        const yesterdayData = data.forecast.forecastday[0]; // gårdagens data
        const yesterdayTemp = yesterdayData.hour[yesterdayHour].temp_c;
        document.getElementById('temp-yesterday').innerText = yesterdayTemp.toFixed(1) + " °C";

        // Vind, luftfuktighet, tryck
        document.getElementById('wind').innerText = "Vind: " + data.current.wind_m_s.toFixed(1) + " m/s";
        document.getElementById('humidity').innerText = "Luftfuktighet: " + data.current.humidity.toFixed(0) + " %";
        document.getElementById('pressure').innerText = "Tryck: " + data.current.pressure_mb.toFixed(0) + " hPa";

        // Nederbörd och risk
        const todayPrecip = data.forecast.forecastday[1].day.totalprecip_mm;
        const risk = Math.round(Math.min(100, todayPrecip * 10));
        let icon = "☂️"; // default paraply
        if(todayPrecip > 0.2) icon = "❄️"; // snöexempel
        document.getElementById('precipitation').innerHTML = `Nederbörd: ${todayPrecip.toFixed(1)} mm | Risk 24h: ${risk}% <span class="icon">${icon}</span>`;

        // Dagens min/max
        const todayTemps = data.forecast.forecastday[1].hour.map(h => h.temp_c);
        const minTemp = Math.min(...todayTemps);
        const maxTemp = Math.max(...todayTemps);
        const minIndex = todayTemps.indexOf(minTemp);
        const maxIndex = todayTemps.indexOf(maxTemp);
        const hours = data.forecast.forecastday[1].hour.map(h => new Date(h.time));
        document.getElementById('temp-minmax').innerHTML = 
            `Min: ${minTemp.toFixed(1)} °C kl ${hours[minIndex].getHours()}:00<br>` +
            `Max: ${maxTemp.toFixed(1)} °C kl ${hours[maxIndex].getHours()}:00`;

        // Gårdagens min/max
        const yesterdayTemps = data.forecast.forecastday[0].hour.map(h => h.temp_c);
        const minY = Math.min(...yesterdayTemps);
        const maxY = Math.max(...yesterdayTemps);
        const minYIndex = yesterdayTemps.indexOf(minY);
        const maxYIndex = yesterdayTemps.indexOf(maxY);
        const yHours = data.forecast.forecastday[0].hour.map(h => new Date(h.time));
        document.getElementById('temp-yesterday-minmax').innerHTML =
            `Min: ${minY.toFixed(1)} °C kl ${yHours[minYIndex].getHours()}:00<br>` +
            `Max: ${maxY.toFixed(1)} °C kl ${yHours[maxYIndex].getHours()}:00`;

        document.getElementById('weather-updated').innerText = 'Senast uppdaterad: ' + now.toLocaleTimeString('sv-SE');

    } catch(err) {
        console.error("WeatherAPI fel:", err);
    }
}

// Init
updateDateWeek();
updateWeather();

// Intervaller
setInterval(updateWeather, 10*60*1000);
</script>
</body>
</html>

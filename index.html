<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Väder & Elpris - Zon 4</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #000;       /* Svart bakgrund */
    color: #fff;            /* Vit text */
    margin: 20px;
  }
  h1, h2 {
    margin: 10px 0;
    color: #fff;
  }
  .section {
    margin-bottom: 25px;
    padding: 10px;
    background: #111;       /* Mörk sektion */
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(255,255,255,0.1);
  }
  .weather-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
  }
  .weather-item {
    background: #222;       /* Mörk ruta */
    padding: 10px;
    border-radius: 6px;
    text-align: center;
    color: #fff;
  }
  .elpris {
    display: flex;
    justify-content: space-around;
    padding: 10px;
    background: #111;       /* Mörk sektion */
    border-radius: 6px;
  }
  .elpris div {
    text-align: center;
    color: #fff;
  }
  .elpris-now {
    font-weight: bold;
    color: #ff5555; /* Rött för aktuellt pris */
  }
  .elpris-prev {
    color: #55aaff; /* Blått för föregående pris */
  }
  .small-text {
    font-size: 0.8em;
    color: #aaa;
  }
</style>
</head>
<body>
  <h1>Väder & Elpris - Södra Sverige (Zon 4)</h1>
  <div id="dateTime" class="small-text"></div>

  <div class="section">
    <h2>Väder</h2>
    <div class="weather-grid" id="weatherGrid">
      <!-- Här fylls väderdata -->
    </div>
    <div class="small-text" id="weatherUpdateTime"></div>
  </div>

  <div class="section">
    <h2>Elpriser</h2>
    <div class="elpris">
      <div>
        Föregående pris<br>
        <span class="elpris-prev" id="elprisPrev">--</span><br>
        <span class="small-text" id="elprisPrevTime">--:--</span>
      </div>
      <div>
        Aktuellt pris<br>
        <span class="elpris-now" id="elprisNow">--</span><br>
        <span class="small-text" id="elprisNowTime">--:--</span>
      </div>
    </div>
  </div>

<script>
const lat = 57.114025;
const lon = 14.168177;

// Uppdatera datum och tid överst
function updateDateTime() {
  const now = new Date();
  document.getElementById('dateTime').innerText = now.toLocaleString('sv-SE', {weekday:'long', year:'numeric', month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'});
}

// Hämta väder från temperatur.nu (SMHI “känns som” approximation)
async function fetchWeather() {
  try {
    const res = await fetch(`https://temperatur.nu/api/v1/weather/point?lat=${lat}&lon=${lon}`);
    const data = await res.json();
    const grid = document.getElementById('weatherGrid');
    grid.innerHTML = '';

    const tempNow = data.temperature.value.toFixed(1);
    const feelsLike = data.feels_like.value.toFixed(1);

    grid.innerHTML += `
      <div class="weather-item">
        Temperatur<br>
        <b>${tempNow}°C</b>
      </div>
      <div class="weather-item">
        Känns som<br>
        <b>${feelsLike}°C</b>
      </div>
      <div class="weather-item">
        Vind<br>
        <b>${data.wind_speed} m/s</b>
      </div>
      <div class="weather-item">
        Luftfuktighet<br>
        <b>${data.humidity}%</b>
      </div>
    `;

    const updateTime = new Date(data.last_update);
    document.getElementById('weatherUpdateTime').innerText = `Senast uppdaterad: ${updateTime.toLocaleTimeString('sv-SE')}`;
  } catch(e) {
    console.error('Fel vid hämtning av väder:', e);
  }
}

// Hämta elpriser för zon 4
async function fetchElpris() {
  try {
    const res = await fetch('https://api.elprisetjustnu.se/v1/prices/SE4.json');
    const data = await res.json();

    const now = new Date();
    // Hitta aktuell kvartspris för nu
    let currentPrice = data.find(p => new Date(p.time_start) <= now && now < new Date(p.time_end));
    let prevPrice = data[data.indexOf(currentPrice)-1] || currentPrice;

    document.getElementById('elprisNow').innerText = currentPrice.SEK_per_kWh.toFixed(2) + ' kr/kWh';
    document.getElementById('elprisNowTime').innerText = new Date(currentPrice.time_start).toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});

    document.getElementById('elprisPrev').innerText = prevPrice.SEK_per_kWh.toFixed(2) + ' kr/kWh';
    document.getElementById('elprisPrevTime').innerText = new Date(prevPrice.time_start).toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});
  } catch(e) {
    console.error('Fel vid hämtning av elpris:', e);
  }
}

// Init
function init() {
  updateDateTime();
  fetchWeather();
  fetchElpris();
  // Uppdatera varje 5 min för väder, varje 15 min för elpris
  setInterval(updateDateTime, 60000);
  setInterval(fetchWeather, 5*60*1000);
  setInterval(fetchElpris, 15*60*1000);
}

init();
</script>
</body>
</html>

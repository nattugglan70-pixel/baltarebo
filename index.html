<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Väder & Elpris Södra Sverige</title>
<style>
  body { background-color: #000; color: #fff; font-family: Arial, sans-serif; padding: 20px; }
  h1 { color: #fff; }
  .section { margin-bottom: 30px; }
  .label { font-weight: bold; }
  .value { margin-left: 10px; }
  .el-current { color: #ff0; } /* gul för aktuellt pris */
  .el-prev { color: #0ff; }    /* cyan för föregående pris */
  .card { background-color: #111; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
</style>
</head>
<body>

<h1>Väder & Elpris Södra Sverige (S4)</h1>

<div class="section" id="weather">
  <h2>Väder</h2>
  <div class="card" id="weather-info">Laddar väder...</div>
</div>

<div class="section" id="elprice">
  <h2>Elpriser</h2>
  <div class="card" id="el-info">Laddar elpriser...</div>
</div>

<script>
// --- Inställningar ---
const LAT = 57.114025;
const LON = 14.168177;
const EL_ZONE = 4;

// --- Funktion för att hämta väder ---
async function fetchWeather() {
  try {
    const res = await fetch(`https://www.temperatur.nu/api/forecast/${LAT},${LON}/json`);
    const data = await res.json();
    const nowTemp = data.temperature.current ?? "–";
    const feelsLike = data.temperature.feels_like ?? "–";
    const wind = data.wind.speed ?? "–";
    const humidity = data.humidity.current ?? "–";
    const updateTime = new Date().toLocaleTimeString();
    document.getElementById("weather-info").innerHTML = `
      <div><span class="label">Temperatur:</span><span class="value">${nowTemp} °C</span></div>
      <div><span class="label">Känns som:</span><span class="value">${feelsLike} °C</span></div>
      <div><span class="label">Vind:</span><span class="value">${wind} m/s</span></div>
      <div><span class="label">Luftfuktighet:</span><span class="value">${humidity} %</span></div>
      <div><span class="label">Uppdaterat:</span><span class="value">${updateTime}</span></div>
    `;
  } catch {
    document.getElementById("weather-info").textContent = "Kunde inte hämta väder.";
  }
}

// --- Funktion för att hämta elpris ---
async function fetchElPrice() {
  try {
    const res = await fetch(`https://elprisetjustnu.se/api/v1/prices/${EL_ZONE}/now`);
    const data = await res.json();
    const current = data.SEK_per_kWh ?? "–";
    const prev = data.previous?.SEK_per_kWh ?? "–";
    const hour = data.hour ?? "--";
    const updateTime = new Date().toLocaleTimeString();
    document.getElementById("el-info").innerHTML = `
      <div><span class="label">Föregående pris:</span><span class="value el-prev">${prev} kr/kWh</span></div>
      <div><span class="label">Aktuellt pris:</span><span class="value el-current">${current} kr/kWh</span> (timme ${hour})</div>
      <div><span class="label">Uppdaterat:</span><span class="value">${updateTime}</span></div>
    `;
  } catch {
    document.getElementById("el-info").textContent = "Kunde inte hämta elpris.";
  }
}

// --- Starta och uppdatera automatiskt var 15:e minut ---
fetchWeather();
fetchElPrice();
setInterval(fetchWeather, 15*60*1000);
setInterval(fetchElPrice, 15*60*1000);
</script>

</body>
</html>

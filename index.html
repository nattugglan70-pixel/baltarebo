<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

.box {
  background: #1a1a1a;
  padding: 20px;
  margin: 15px;
  border-radius: 10px;
  width: 340px;
}

h2 {
  text-align: center;
  margin-bottom: 15px;
}

.row {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
}

.big {
  font-size: 20px;
  font-weight: bold;
}

.green { color: #00ff99; }
.orange { color: #ff9900; }

.small {
  font-size: 12px;
  color: #aaa;
  text-align: center;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="box">
  <h2>Väder</h2>

  <div class="row">
    <div>Temperatur</div>
    <div id="temp" class="big">--</div>
  </div>

  <div class="row">
    <div>Vind</div>
    <div id="wind" class="big">--</div>
  </div>

  <div class="small" id="weatherUpdated">Uppdaterar...</div>
</div>

<div class="box">
  <h2>Elpris SE4</h2>

  <div class="row">
    <div>Aktuell timme</div>
    <div id="current" class="big green">--</div>
  </div>

  <div class="row">
    <div>Föregående timme</div>
    <div id="previous" class="big orange">--</div>
  </div>

  <div id="elUpdated" class="small">Uppdaterar...</div>
</div>

<script>

// ===== VÄDER =====
async function loadWeather() {
  try {
    const lat = 57.114025;
    const lon = 14.168177;

    const response = await fetch(
      `https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/${lon}/lat/${lat}/data.json`
    );

    const data = await response.json();
    const now = new Date();

    const next = data.timeSeries.find(t =>
      new Date(t.validTime) >= now
    );

    const temp = next.parameters.find(p => p.name === "t").values[0];
    const wind = next.parameters.find(p => p.name === "ws").values[0];

    document.getElementById("temp").innerText = temp.toFixed(1) + " °C";
    document.getElementById("wind").innerText = wind.toFixed(1) + " m/s";
    document.getElementById("weatherUpdated").innerText =
      "Uppdaterad: " + now.toLocaleTimeString("sv-SE");

  } catch (e) {
    console.error("Weather error:", e);
    document.getElementById("temp").innerText = "Fel";
  }
}


// ===== ELPRIS =====
async function loadElectricity() {
  try {
    const response = await fetch(
      "https://api.energidataservice.dk/dataset/Elspotprices?limit=2&sort=-HourUTC&filter={\"PriceArea\":\"SE4\"}"
    );

    const data = await response.json();

    if (!data.records || data.records.length < 2) {
      document.getElementById("current").innerText = "Ingen data";
      return;
    }

    const current = data.records[0];
    const previous = data.records[1];

    const currentPrice =
      current.SpotPriceSEK ?? current.SpotPriceEUR ?? 0;

    const previousPrice =
      previous.SpotPriceSEK ?? previous.SpotPriceEUR ?? 0;

    document.getElementById("current").innerText =
      (currentPrice / 1000).toFixed(2) + " SEK/kWh";

    document.getElementById("previous").innerText =
      (previousPrice / 1000).toFixed(2) + " SEK/kWh";

    document.getElementById("elUpdated").innerText =
      "Uppdaterad: " + new Date().toLocaleTimeString("sv-SE");

  } catch (e) {
    console.error("Electric error:", e);
    document.getElementById("current").innerText = "Fel vid hämtning";
  }
}

loadWeather();
loadElectricity();

setInterval(loadWeather, 300000);
setInterval(loadElectricity, 300000);

</script>

</body>
</html>
